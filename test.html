<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>
<script>var OneSignal = OneSignal || [];
const oneSignalAppId = "97c4642d-3816-43b7-89f6-d1de62e1f412";
OneSignal.push(['init',{
	appId: oneSignalAppId,
	// Your other init settings
	notifyButton: {
			enable: true,
	},
}]);
</script>

<script>

	function findGetParameter(parameterName) {
		let result = null,
		tmp = [];
		location.search
			.substr(1)
			.split("&")
			.forEach(function (item) {
				tmp = item.split("=");
				if (tmp[0] === parameterName)
					result = decodeURIComponent(tmp[1]);
			});
		return result;
	}
	function setCookie(cname, cvalue, exdays) {
		var d = new Date();
		d.setTime(d.getTime() + (exdays*24*60*60*1000));
		var expires = "expires="+ d.toUTCString();
		document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}
	function getCookie(cname) {
		let name = cname + "=";
		let decodedCookie = decodeURIComponent(document.cookie);
		let ca = decodedCookie.split(';');
		for(let i = 0; i < ca.length; i++) {
			let c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
	
	// Get user id from the GET parameter and store it into a cookie as external id
	(async function getUserIdParam() {
		OneSignal.push(function() {
			const userId = findGetParameter("onesignal_push_id");
			// Generate an external user id that's identical to the local userid
			//await OneSignal.setExternalUserId(userId);
			if (userId)
				setCookie("onesignal_userid", userId, 30);
		});
	})();
</script>


<button onclick="addOnesignalTags()">test</button>

<script>
	// Attempt to add tags to subscription
	async function addOnesignalTags() {
		// Constants
		const appId = oneSignalAppId;
		const apiKey = "ODlmZjI3NmMtNGRlNS00NDVjLTg3OTEtN2ZmZmVlMDI2ZDVh";
	
		// Get userId
		const userId = getCookie("onesignal_userid");
		if (!userId) {
			throw new Error("missing userid");
		}
		
		// Use the rest api to set relevant tags
		const response = await fetch(`https://onesignal.com/api/v1/players/${userId}`, {
			body: JSON.stringify({
				tags: {
					"tag1" : "value1",
					"tag2" : "value2",
					// ...
				},
			}),
			method: "PUT",
			mode: "cors",
			headers: {
				"Content-Type" : "application/json",
				"Authorization" : `BASIC ${apiKey}`,
			},
		});
	
		// Do something with the respose
		console.log(await response.json());
	}
 	 	
	// Test with known user id
	/*
	OneSignal.push(async function () {
		await OneSignal.registerForPushNotifications();
		OneSignal.isPushNotificationsEnabled(function (notifsEnabled) {
			OneSignal.getUserId(async function (userId) {
				console.log("userid", userId);
				
				// Generate an external user id that's identical to the local userid
				await OneSignal.setExternalUserId(userId);
				
				// Set the cookie and call our function
				setCookie("onesignal_userid", userId, 1);
				addOnesignalTags();
			});
		});
	});*/
	
</script>
