<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>
<script>var OneSignal = OneSignal || [];
const oneSignalAppId = "97c4642d-3816-43b7-89f6-d1de62e1f412";
OneSignal.push(['init',{
	appId: oneSignalAppId,
	// Your other init settings
	notifyButton: {
			enable: true,
	},
}]);
</script>
		


<button onclick="addOnesignalTags()">test</button>

<script>
	function findGetParameter(parameterName) {
		let result = null,
		tmp = [];
		location.search
			.substr(1)
			.split("&")
			.forEach(function (item) {
				tmp = item.split("=");
				if (tmp[0] === parameterName)
					result = decodeURIComponent(tmp[1]);
			});
		return result;
	}
	function setCookie(cname, cvalue, exdays) {
		var d = new Date();
		d.setTime(d.getTime() + (exdays*24*60*60*1000));
		var expires = "expires="+ d.toUTCString();
		document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}
	function getCookie(cname) {
		let name = cname + "=";
		let decodedCookie = decodeURIComponent(document.cookie);
		let ca = decodedCookie.split(';');
		for(let i = 0; i < ca.length; i++) {
			let c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
	
	async function addOnesignalTags() {
		console.log('test')
		const appId = oneSignalAppId;
		const apiKey = "ODlmZjI3NmMtNGRlNS00NDVjLTg3OTEtN2ZmZmVlMDI2ZDVh";
	
		// Get userId
		let userId = findGetParameter("onesignal_push_id");
		if (userId) {
			setCookie("onesignal_userid", userId, 60);
		} else {
			userId = getCookie("onesignal_userid");
		}
		
		// userId not available!
		if (!userId) {
			throw new Error("missing userid");
		}
		
		// use the rest api to set relevant tags
		const response = await fetch(`https://onesignal.com/api/v1/apps/${appId}/users/${userId}`, {
			body: JSON.stringify({
				tags: {
					"tag1" : "value1",
					"tag2" : "value2",
					// ...
				},
			}),
			method: "PUT",
			mode: "cors",
			headers: {
				"Content-Type" : "application/json",
				"Authorization" : `BASIC ${apiKey}`,
			},
		});
	
		// Do something with the respose
		console.log(await response.json());
	}
 	 	
	OneSignal.push(function () {
		OneSignal.getUserId(function (userId) {
			console.log("userid", userId);
			setCookie("onesignal_userid", userId, 1);
			addOnesignalTags();
		});
	});
	OneSignal.push(function() {
		OneSignal.on('notificationDisplay', function(event) {
			console.warn('OneSignal notification displayed:', event);
		});

	//This event can be listened to via the `on()` or `once()` listener
	});
</script>
